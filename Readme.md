# API-ядро для отработки практики

## Запуск

- Production:
```bash
python main.py -t prod
```

- Develop:
```bash
python main.py -t dev
```

## Результаты тестирования

```bash
Name                                Stmts   Miss  Cover
-------------------------------------------------------
hanlders\__init__.py                    6      1    83%
hanlders\cart.py                       31      0   100%
hanlders\categories.py                 11      2    82%
hanlders\products.py                   32      2    94%
tests\__init__.py                       0      0   100%
tests\test_get_cart.py                  6      0   100%
tests\test_get_category_list.py         6      0   100%
tests\test_get_product_list.py         14      0   100%
tests\test_get_single_product.py        7      0   100%
tests\test_hello_message.py             6      0   100%
tests\test_help.py                      6      0   100%
tests\test_put_product_to_cart.py      16      0   100%
-------------------------------------------------------
TOTAL                                 141      5    96%
```

- Суммароное покрытие тестами выше 80%

## Функционал

1. Приветствие
2. Помощь
3. Получение списка продуктов по категории -> Никита
4. Получение информации об одном продукте -> Саша
5. Получение списка категорий -> Катя
6. Добавление товара в корзину -> Оля
7. Вывести корзину -> Андрей

## Реализация

### Общее описание

- Формат запроса:
```json
{
  "action": <int>,
  "data": <dict|None>
}
```

- Формат ответа:
```json
{
  "code": <int>,
  "data": <string>
}
```

- Коды ответа и их обозначение:

  **200** - Успех - запрос успешно обработан\
  **201** - Создано/добавлено - запись успешно добавлена или создана\
  **400** - Неверный запрос - введен неверный или несуществующий запрос\
  **404** - Не найдено или неизвестная команда - например выбран несуществующий товар\
  **409** - Конфликт выполнения запроса - например на складе не хватает товара для покупки\
  **500** - Ошибка обработки запроса - например, введены неверные данные для запроса фильтрации

---

### Приветствие

Функция: `hanlders.set_hello_message`

Необходимо возвращать сообщение с приветствием пользователя в следующем формате:

**Запрос**
```json
{
    "action": 0,
    "filter": {}
}
```

**Ответ:**
```json
{
    "code": 200,
    "data": "Привет, пользователь! Рады тебя приветствовать в магазине. Здесь ты можешь просмотреть товары, купить что-то. Для более подробной информации вызови помощь командой '1'"
}
```

---

### Помощь

Функция: `hanlders.help`

Необходимо перечислить имеющиеся команды с расшифровкой того, для чего нужна каждая команда, формат следующий:

**Запрос**
```json
{
    "action": 1,
    "filter": {}
}
```

**Ответ:**
```json
{
    "code": 200,
    "data": "1 - Вывести это сообщение.\n2 - Показать список продуктов. Можно передать в тело номер категории, чтобы получить товары определенной категории. ..."
}
```

---

### Получение списка продуктов по категории

Функция: `hanlders.products.get_product_list`

Возвращает либо все товары магазина, если фильтры не указаны, либо товары, отфильтрованные по двум признакам: цена и категория.

**Запрос**
```json
{
    "action": 2,
    "filter": {
        "price": ['>100'|'<100'|'<=100'|'>=100'|None],
        "category": <int|None>
    }
}
```

**Ответ:**
```json
{
    "code": 200,
    "data": "1. Груша (200 руб/кг) 10 шт.\n2. Яблоки (1000 руб/кг) 10шт."
}
```

**Примечание:**
Если введен номер несуществующей категории, то вывести пустой список товаров

---

### Получение информации об одном продукте

Функция: `hanlders.products.get_single_product`

Необходимо возвращать сообщение с приветствием пользователя в следующем формате:

**Запрос**
```json
{
    "action": 4,
    "filter": {
      "id": <int>
    }
}
```

**Ответы:**
```json
{
    "code": 200,
    "message": "Груша.\nЦена: 200 рублей за кг\nОстаток на складе: 10 штук\nОписание: Длинное описание"
}
```

```json
{
    "code": 404,
    "message": "Товара с таким номер не найдено"
}
```

---

### Получение списка категорий

Функция: `hanlders.categories.get_category_list`

Необходимо возвращать список категорий товаров с выводом их идентификаторов для возможности делать запросы:

**Запрос**
```json
{
    "action": 3,
    "filter": {}
}
```

**Ответ:**
```json
{
    "code": 200,
    "data": "1. Фрукты\n2. Овощи"
}
```

---

### Добавление товара в корзину

Функция: `hanlders.cart.put_product_to_cart`

Добавить выбранный товар в корзину в указанном количестве:

**Запрос**
```json
{
    "action": 5,
    "filter": {
      "id": 1,
      "count": 5
    }
}
```

**Ответы:**
```json
{
    "code": 201,
    "message": "Товар 'Яблоки' в количестве 5 штук добавлен в корзину успешно"
}
```

```json
{
    "code": 404,
    "message": "Товара с таким номер не найдено."
}
```

```json
{
    "code": 409,
    "message": "Невозможно добавить товар 'Яблоки' в количестве 11 штук в корзину, потому что их осталось всего 10."
}
```

---

### Вывести корзину

Функция: `hanlders.cart.get_cart`

Необходимо возвращать список товаров в корзине с их количеством:

**Ответ:**
```json
{
    "code": 200,
    "message": "1. Яблоки (200 руб/кг) добавлено 5 штук\n2. Груши (150 руб/кг) добавлено 1 штука"
}
```